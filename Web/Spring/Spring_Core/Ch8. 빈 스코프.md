## Ch8. 빈 스코프
### 스코프
빈이 존재할 수 있는 범위

* **싱글톤** : 기본 스코프, 스프링 컨테이너의 시작과 종료까지 유지되는 가장 넓은 범위의 스코프
* **프로토타입** : 스프링 컨테이너는 프로토타입 빈의 생성과 의존관계 주입까지만 관여하고 더는 관리하지 않는 매우 짧은 범위의 스코프이다.
* **웹 관련 스코프**
  * request : 웹 요청이 들어오고 나갈 때 까지 유지되는 스코프
  *  session : 웹 세션이 생성되고 종료될 때 까지 유지되는 스코프
  *  application : 웹의 서블릿 컨텍스트와 같은 범위로 유지되는 스코프 

### 싱글톤 스코프의 특징
* 오직 빈을 하나만 생성
* 빈을 생성하고, 의존관계 주입, 초기화, 종료 메소드까지 호출

### 프로토타입 스코프의 특징
* 컨테이너에게 빈을 요청할 때 마다 항상 새로운 빈을 생성
* 빈을 생성하고, 의존관계 주입, 초기화까지만 처리
* 종료 메소드가 호출되지 않음

### 프로토타입 빈에서 싱글톤 빈을 참조하는 경우
문제X, 프로토타입 빈의 인스턴스는 계속 생성되고 주입받는 싱글톤 빈은 계속 동일한 하나의 인스턴스일 것이다.

### 싱글톤 빈에서 프로토타입 빈을 참조하는 경우
싱글톤 빈의 인스턴스는 단 한번만 생성되고 그 때 프로토타입 빈의 주입도 이미 완료된다. 그렇기 때문에 **싱글톤 빈을 사용할때 주입받은 프로토타입 빈이 변경(업데이트) 되지 않는다는 문제**점이 생긴다.

### DL(Dependency Lookup, 의존관계 조회(탐색))
의존관계를 외부에서 주입(DI) 받는게 아니라 직접 필요한 의존관계를 찾는 것

### ObjectProvider
지정한 빈을 컨테이너에서 대신 찾아주는 DL을 제공하는 것. 싱글톤 빈에서 프로토타입 빈을 참조할 때 참조할 때 마다 새로운 프로토타입 빈을 생성시키기 위해서 사용. 

### JSR-330 Provider
ObjectProvider와 동일한 역할을 하지만 스프링에서 제공하는 것이 아닌 자바에서 제공하는 라이브러리

### HTTP 스코프
* HTTP요청 시점에 생성되고 요청이 끝나는 시점에 소멸
* 클라이언트의 요청이 없으면 빈이 생성되지 않음(생명주기를 시작하지 않음)
* 따라서, 요청이 오기 전까지 작업을 미뤄야 한다.

예를 들어, 웹 요청이 들어올때마다 요청 내용이 작성되는 Logger가 있다고 하자. 
```java
@Component
@Scope(value = "request")
public class MyLogger {
    ...
}
```
request 스코프에 해당하는 빈은 http 요청이 있어야만 생명주기가 시작되기 때문에 http요청이 들어오기 전에는 오류가 발생할 것이다. 왜냐하면 스프링 빈 생명주기(빈 객체를 생성하고 의존관계를 주입 하는 단계)에서 Logger의 작업은 끝났기 때문이다. 따라서 Logger의 작업을 스프링이 실행되고 의존관계를 주입되는 단계가 아니라 http 요청이 들어올 때로 작업을 미루어야 한다. 

### 해결 방법
1. **Provider를 사용한다.**
2. **프록시를 사용하여 MyLogger 클래스를 상속받은 가짜 프록시 객체를 만든다.** -> 이 프록시 객체는 요청이 오면 원래 빈을 반환하는 방식으로 원본 객체를 호출한다. 

Provider, Proxy는 실제 객체의 조회가 필요한 시점까지 지연처리할 수 있다는 점이 중요하다.